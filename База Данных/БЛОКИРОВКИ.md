
**Блокировки строк (Row Locks)**  
Блокировки строк применяются к отдельным строкам в таблице. Они позволяют **гранулярно** контролировать доступ к данным, что улучшает параллелизм и производительность при работе с большим количеством **транзакций**.

**Shared Lock (S или Shared):**

- **Описание:** Позволяет другим **транзакциям** также устанавливать shared-блокировки, но блокирует **exclusive-блокировки**.
- **Использование:** Чтение данных (SELECT).
    
- **Пример:**
    
    `SELECT * FROM orders WHERE id = 1 FOR SHARE;`


**Exclusive Lock (X или Exclusive):**

- **Описание:** Блокирует другие shared и exclusive блокировки. Позволяет только одной транзакции изменять строку.
    
- **Использование:** Обновление данных (UPDATE, DELETE).
- **Пример:** _(не виден на скрине)_

SELECT * FROM orders WHERE id = 1 FOR UPDATE;
UPDATE orders  SET anount = amount  * 0.9 WHERE id = 1 << x-lock
UPDATE orders SET amount = $1 WHERE id = 1 << --- x-lock


**Блокировки Таблиц (Table Locks)**  
Блоки таблиц применяются ко всей таблице. Они используются для операций которые затрагивают множество строк или структура таблицы, таких как добавление индексов или изменение схемы.

**Виды блокировки Таблиц:**
1) Access Share Lock
2) Row Share Lock
3) Row Exclusive Lock



### **SELECT FOR UPDATE**

Механизм `SELECT FOR UPDATE` в базах данных PostgreSQL используется для управления конкурентным доступом к данным. Этот механизм позволяет блокировать строки, которые будут обновляться, предотвращая возможные конфликты при параллельном доступе к тем же данным.

### **Основные моменты использования `SELECT FOR UPDATE`:**

1. **Блокировка строк для обновления:**  
    Запрос `SELECT FOR UPDATE` блокирует выбранные строки для обновления, предотвращая их изменения другими транзакциями до завершения текущей транзакции.

   **Блокировки на уровне строк:**  
    В PostgreSQL механизм использует блокировки на уровне строк, а не на уровне всей таблицы, что позволяет повысить параллелизм и производительность.

1.  **Использование с JOIN:**  
    `SELECT FOR UPDATE` можно использовать в запросах с `JOIN` для блокировки строк из нескольких таблиц.


### Поведение в конкурентных сценариях:

- **Блокировка:** Транзакция, которая выполняет `SELECT FOR UPDATE`, получает эксклюзивную блокировку на выбранные строки. Другие транзакции, которые пытаются выполнить `SELECT FOR UPDATE` на те же строки, будут ждать завершения первой транзакции.
    
- **Deadlock (Взаимоблокировка):** Важно проектировать транзакции так, чтобы избегать взаимоблокировок. Это может произойти, если две транзакции одновременно блокируют ресурсы, которые друг другу необходимы.